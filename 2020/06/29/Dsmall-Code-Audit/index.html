<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>DSMall的那些洞，你能发现吗？ | MS509 Team</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 4.2.1"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">DSMall的那些洞，你能发现吗？</h1><a id="logo" href="/.">MS509 Team</a><p class="description">Mission Studio</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/contact/"><i class="fa fa-comments"> 联系</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">DSMall的那些洞，你能发现吗？</h1><div class="post-meta">2020-06-29<span> | </span><span class="category"><a href="/categories/WEB%E5%AE%89%E5%85%A8/">WEB安全</a><a href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">代码审计</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 1.9k</span><span class="post-meta-item-text"> 字</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 7</span><span class="post-meta-item-text"> 分钟</span></span></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01-前言"><span class="toc-number">1.</span> <span class="toc-text">0x01 前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02-介绍"><span class="toc-number">2.</span> <span class="toc-text">0x02 介绍</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x03-漏洞统计"><span class="toc-number">3.</span> <span class="toc-text">0x03 漏洞统计</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x04-漏洞分析"><span class="toc-number">4.</span> <span class="toc-text">0x04 漏洞分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#远程代码执行漏洞一"><span class="toc-number">4.1.</span> <span class="toc-text">远程代码执行漏洞一</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞利用"><span class="toc-number">4.1.1.</span> <span class="toc-text">漏洞利用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#远程代码执行漏洞二"><span class="toc-number">4.2.</span> <span class="toc-text">远程代码执行漏洞二</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞利用-1"><span class="toc-number">4.2.1.</span> <span class="toc-text">漏洞利用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#远程代码执行漏洞三"><span class="toc-number">4.3.</span> <span class="toc-text">远程代码执行漏洞三</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#远程代码执行漏洞四"><span class="toc-number">4.4.</span> <span class="toc-text">远程代码执行漏洞四</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#远程代码执行漏洞五"><span class="toc-number">4.5.</span> <span class="toc-text">远程代码执行漏洞五</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL注入漏洞一"><span class="toc-number">4.6.</span> <span class="toc-text">SQL注入漏洞一</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL注入漏洞二"><span class="toc-number">4.7.</span> <span class="toc-text">SQL注入漏洞二</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL注入漏洞三"><span class="toc-number">4.8.</span> <span class="toc-text">SQL注入漏洞三</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x05-结语"><span class="toc-number">5.</span> <span class="toc-text">0x05 结语</span></a></li></ol></div></div><div class="post-content"><p><strong>Author:flystart@MS509</strong></p>
<h1 id="0x01-前言"><a href="#0x01-前言" class="headerlink" title="0x01 前言"></a>0x01 前言</h1><p>​     最近一段时间专门在研究php 反序列化漏洞的挖掘和利用，这篇文章可以算做是研究成果的一个实践输出，文中所有的漏洞本来是提交到cnvd和补天的，被驳回了几次有点心态爆炸，浪费那些宝贵的时间何必呢？该公司开发的这几款web app 几乎都存在文章中审计到的漏洞，本文以DSmall为例进行分析，所有的漏洞分析文档见文末，如需要poc可以私信。</p>
<p><img src="/2020/06/29/Dsmall-Code-Audit/image-20200420102016779.png" alt></p>
<h1 id="0x02-介绍"><a href="#0x02-介绍" class="headerlink" title="0x02 介绍"></a>0x02 介绍</h1><p>​        DSMall是长沙德尚网络科技有限公司开发的多用户商城系统，基于thinkphp5.0框架开发，目前最新版本是5.0.6。<br>【官        网】<a href="http://www.csdeshang.com/" target="_blank" rel="noopener">http://www.csdeshang.com/</a><br>【下载地址】<a href="http://www.csdeshang.com/home/download/index.html" target="_blank" rel="noopener">http://www.csdeshang.com/home/download/index.html</a><br>【测试环境】php 5.6.27、mysql5.0.11、apache2.2<br>【测试版本】DSMALL 5.0.6<br><img src="/2020/06/29/Dsmall-Code-Audit/image-20200420102910072.png" alt></p>
<h1 id="0x03-漏洞统计"><a href="#0x03-漏洞统计" class="headerlink" title="0x03 漏洞统计"></a>0x03 漏洞统计</h1><table>
<thead>
<tr>
<th>漏洞类型</th>
<th>数量</th>
<th>级别</th>
<th>利用条件</th>
</tr>
</thead>
<tbody><tr>
<td>远程代码执行一</td>
<td>1</td>
<td>高</td>
<td>前台注册账户</td>
</tr>
<tr>
<td>远程代码执行二</td>
<td>1</td>
<td>高</td>
<td>无</td>
</tr>
<tr>
<td>远程代码执行三</td>
<td>1</td>
<td>高</td>
<td>前台注册账户</td>
</tr>
<tr>
<td>远程代码执行四</td>
<td>1</td>
<td>高</td>
<td>无</td>
</tr>
<tr>
<td>远程代码执行五</td>
<td>1</td>
<td>高</td>
<td>无</td>
</tr>
<tr>
<td>SQL注入漏洞一</td>
<td>1</td>
<td>中</td>
<td>后台管理员权限</td>
</tr>
<tr>
<td>SQL注入漏洞二</td>
<td>1</td>
<td>中</td>
<td>后台管理员权限</td>
</tr>
<tr>
<td>SQL注入漏洞三</td>
<td>1</td>
<td>高</td>
<td>无</td>
</tr>
</tbody></table>
<h1 id="0x04-漏洞分析"><a href="#0x04-漏洞分析" class="headerlink" title="0x04 漏洞分析"></a>0x04 漏洞分析</h1><h2 id="远程代码执行漏洞一"><a href="#远程代码执行漏洞一" class="headerlink" title="远程代码执行漏洞一"></a>远程代码执行漏洞一</h2><p>利用条件：前台注册账户<br>Home模块 Memberinformation控制器cut方法存在可以利用的反序列化操作，利用thinkphp 反序列化代码执行pop chain 可以写文件getshell。<br>\application\home\controller\Memberinformation.php</p>
<p><img src="/2020/06/29/Dsmall-Code-Audit/image-20200420103226950.png" alt></p>
<p>\vendor\topthink\think-image\src\Image.php</p>
<p><img src="/2020/06/29/Dsmall-Code-Audit/wps1.jpg" alt> </p>
<p>$newfile = str_replace(str_replace(‘/index.php’, ‘’, BASE_SITE_URL).’/uploads’, BASE_UPLOAD_PATH, input(‘post.newfile’));</p>
<p>$newfile 来自 $_POST[‘newfile’],然后通过SplFileInfo类对象来判断文件是否存在，当该SplFileInfo类构造参数是一个phar文件的时候就会发生反序化操作，相关知识参考：<a href="https://xz.aliyun.com/t/2958。" target="_blank" rel="noopener">https://xz.aliyun.com/t/2958。</a></p>
<p><img src="/2020/06/29/Dsmall-Code-Audit/image-20200420103533837.png" alt></p>
<p><img src="/2020/06/29/Dsmall-Code-Audit/image-20200420103555916.png" alt></p>
<h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>生成phar文件，然后通过前台头像或其他上传文件接口上传到目标服务器上，这里直接利用上传文件接口dsmall506/public/index.php?s=home/Snsalbum/swfupload 上传得到路径<br><a href="http://test.com/dsmall506/public/uploads/home/member/1/1_2020031616094143684.jpg" target="_blank" rel="noopener">http://test.com/dsmall506/public/uploads/home/member/1/1_2020031616094143684.jpg</a><br><img src="/2020/06/29/Dsmall-Code-Audit/image-20200420103652363.png" alt></p>
<p><img src="/2020/06/29/Dsmall-Code-Audit/image-20200420103753252.png" alt></p>
<p><img src="/2020/06/29/Dsmall-Code-Audit/image-20200420103812044.png" alt></p>
<p>需要注意的是：<br>Shell 文件会直接生成在php 执行路径下，如果需要生成在web目录下，在poc文件中设置shell文件的绝对路径</p>
<p><img src="/2020/06/29/Dsmall-Code-Audit/wps2.jpg" alt> </p>
<h2 id="远程代码执行漏洞二"><a href="#远程代码执行漏洞二" class="headerlink" title="远程代码执行漏洞二"></a>远程代码执行漏洞二</h2><p>利用条件：无<br>公共model\Goodsbrowse getViewedGoodsList 查看用户浏览过的商品信息，当用户处于登录状态时候直接从缓存中获取商品信息进行反序列化操作，如果尚未登录则从cookie里面获取并解密然后进行反序列化，由于cookie加解密函数的KEY是一个固定的值，写死在代码中，因此反序列化函数unserialize的参数可以被我们控制，利用thinkphp5的代码执行反序列化pop chain 可以往目标服务器写文件getshell.<br>\application\common\model\Goodsbrowse.php</p>
<p><img src="/2020/06/29/Dsmall-Code-Audit/image-20200420104232837.png" alt></p>
<p>\application\common.php</p>
<p><img src="/2020/06/29/Dsmall-Code-Audit/wps3.jpg" alt> </p>
<p>\application\common_global.php</p>
<p><img src="/2020/06/29/Dsmall-Code-Audit/wps4.jpg" alt> </p>
<h3 id="漏洞利用-1"><a href="#漏洞利用-1" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>生成cookie信息并设置访问浏览历史即可getshell</p>
<p><a href="http://test.com/dsmall506/public/home/index/viewed_info" target="_blank" rel="noopener">http://test.com/dsmall506/public/home/index/viewed_info</a></p>
<p>生成cookie信息：</p>
<p><img src="/2020/06/29/Dsmall-Code-Audit/wps5.jpg" alt> </p>
<p><img src="/2020/06/29/Dsmall-Code-Audit/wps6.jpg" alt> </p>
<p>调用栈：</p>
<p><img src="/2020/06/29/Dsmall-Code-Audit/wps7.jpg" alt></p>
<h2 id="远程代码执行漏洞三"><a href="#远程代码执行漏洞三" class="headerlink" title="远程代码执行漏洞三"></a>远程代码执行漏洞三</h2><p>利用条件：前台注册账户<br>公共模块logic\Buy.php buyDecrypt 方法中存在可以被用户控制的反序列化操作，利用thinkphp5的代码执行反序列化pop chain 可以往目标服务器写文件getshell.<br>\application\common\logic\Buy.php<br><img src="/2020/06/29/Dsmall-Code-Audit/wps8.jpg" alt> </p>
<p>查看对buyDecrypt的函数调用，发现有多处调用且参数都可以被用户控制，这里利用修改地址changeAddr这条利用链。</p>
<p><img src="/2020/06/29/Dsmall-Code-Audit/wps9.jpg" alt> </p>
<p>\application\common\logic\Buy.php</p>
<p> public function changeAddr($freight_hash, $city_id, $area_id, $member_id)</p>
<p>\application\home\controller\Buy.php</p>
<p><img src="/2020/06/29/Dsmall-Code-Audit/wps10.jpg" alt> </p>
<p>调用栈</p>
<p>—&gt;\home\controller\Buy.php\change_addr()—&gt;common\logic\Buy.php\changeAddr()—&gt;&gt;common\logic\Buy.php\buyDecrypt()</p>
<p><img src="/2020/06/29/Dsmall-Code-Audit/wps11.jpg" alt> </p>
<p>漏洞利用：</p>
<p>通过分析我们知道</p>
<p>Unserizlize(base64_decode(ds_decrypt(strval($string), sha1(md5($member_id . ‘&amp;’ . MD5_KEY))</p>
<p>, 0)))</p>
<p>$key=sha1(md5($member_id . ‘&amp;’ . MD5_KEY))</p>
<p>$_POST[freight_hash] =ds_encrypt(strval(base64_encode(serialize($a))),$key);</p>
<p>A) MD5_KEY 是一个常量，从源码中获取</p>
<p>B) $member_id可以通过文件上传文件接口dsmall506/public/index.php?s=home/Snsalbum/swfupload 获取</p>
<p><img src="/2020/06/29/Dsmall-Code-Audit/wps12.jpg" alt> </p>
<p><img src="/2020/06/29/Dsmall-Code-Audit/wps13.jpg" alt> </p>
<p>Poc:</p>
<p><img src="/2020/06/29/Dsmall-Code-Audit/wps14.jpg" alt> </p>
<p>Url:<a href="http://test.com/dsmall506/public/index.php?s=home/Buy/change_addr" target="_blank" rel="noopener">http://test.com/dsmall506/public/index.php?s=home/Buy/change_addr</a></p>
<p>Post:city_id=1&amp;area_id=1&amp;freight_hash=se1atRqVpfbQo1INkwRgOXeQIUpFfKnR5lnhQVmjUhnYB9v1NU7JxIxWFRYDA6ihAavR_QiUcQ8</p>
<p><img src="/2020/06/29/Dsmall-Code-Audit/wps15.jpg" alt> </p>
<p><img src="/2020/06/29/Dsmall-Code-Audit/wps16.jpg" alt> </p>
<p><img src="/2020/06/29/Dsmall-Code-Audit/wps17.jpg" alt> </p>
<h2 id="远程代码执行漏洞四"><a href="#远程代码执行漏洞四" class="headerlink" title="远程代码执行漏洞四"></a>远程代码执行漏洞四</h2><p>利用条件：无<br>公共模块model\Cart.php getCartList和getCartNum<br>方法中存在可以被用户控制的反序列化操作，利用thinkphp5的代码执行反序列化pop chain 可以往目标服务器写文件getshell.<br>\application\common\model\Cart.php<br>getCartList 方法反序列化<br><img src="/2020/06/29/Dsmall-Code-Audit/wps18.jpg" alt> </p>
<p>getCartNum反序列化<br><img src="/2020/06/29/Dsmall-Code-Audit/wps19.jpg" alt> </p>
<p>这里对getCartNum这个点的利用进行分析一下。通过查找存在多处对getCartNum的函数的调用，跟踪分析controller子类BaseHome中有一条简单方便的call chain，这条调用链的起点来自BaseHome类的初始化函数中，因此该类的所有子孙类的任何方法调用都会触发这条调用链。整个调用过程：<br>BaseHome::_initialize-&gt;BaseHome::showCartCount-&gt;Cart::getCartNum<br><img src="/2020/06/29/Dsmall-Code-Audit/wps20.jpg" alt><br><img src="/2020/06/29/Dsmall-Code-Audit/wps21.jpg" alt> </p>
<p>阅读showCartCount函数代码，我们知晓要能够触发反序列化操作，必须满足以下两个条件：</p>
<ol>
<li><p>Cookie[‘cart_goods_num’]为空</p>
</li>
<li><p>用户处于未登录状态<br><img src="/2020/06/29/Dsmall-Code-Audit/wps22.jpg" alt><br>Poc：<br><img src="/2020/06/29/Dsmall-Code-Audit/wps23.jpg" alt><br><img src="/2020/06/29/Dsmall-Code-Audit/wps24.jpg" alt><br><img src="/2020/06/29/Dsmall-Code-Audit/wps25.jpg" alt> </p>
</li>
</ol>
<h2 id="远程代码执行漏洞五"><a href="#远程代码执行漏洞五" class="headerlink" title="远程代码执行漏洞五"></a>远程代码执行漏洞五</h2><p>利用条件：无<br>Home模块Cart控制器ajax_load 方法中存在用户可以控制的反序列化操作，利用thinkphp5的代码执行反序列化pop chain 可以往目标服务器写文件getshell.</p>
<p><img src="/2020/06/29/Dsmall-Code-Audit/wps26.jpg" alt> </p>
<p>生成payload:</p>
<p><img src="/2020/06/29/Dsmall-Code-Audit/wps27.jpg" alt> </p>
<p><img src="/2020/06/29/Dsmall-Code-Audit/wps28.jpg" alt> </p>
<p>设置cookie:<br><img src="/2020/06/29/Dsmall-Code-Audit/wps29.jpg" alt> </p>
<p>Request url:<br><a href="http://test.com/dsmall506/public/index.php?s=home/cart/ajax_load" target="_blank" rel="noopener">http://test.com/dsmall506/public/index.php?s=home/cart/ajax_load</a><br><img src="/2020/06/29/Dsmall-Code-Audit/wps30.jpg" alt><br><img src="/2020/06/29/Dsmall-Code-Audit/wps31.jpg" alt> </p>
<h2 id="SQL注入漏洞一"><a href="#SQL注入漏洞一" class="headerlink" title="SQL注入漏洞一"></a>SQL注入漏洞一</h2><p>利用条件：后台管理员账户权限<br>公共模块common/Model/Artcle.php editArticle 和delArticle存在SQL注入漏洞，审计代码只有delArticle函数中的漏洞可被利用。</p>
<p><img src="/2020/06/29/Dsmall-Code-Audit/wps32.jpg" alt><br>\application\admin\controller\Article.php 删除文章功能的Drop方法调用了delArticle 且参数可控，$_GET[artcile_id]==input(‘param.article_id’)<br><img src="/2020/06/29/Dsmall-Code-Audit/wps33.jpg" alt> </p>
<p>Poc:<br>[<a href="http://test.com//dsmall506/public/index.php/admin/article/drop.html?article_id=42+and%20updatexml(1,concat(0x7e,user()),1)]" target="_blank" rel="noopener">http://test.com//dsmall506/public/index.php/admin/article/drop.html?article_id=42+and%20updatexml(1,concat(0x7e,user()),1)]</a>(<a href="http://test.com//dsmall506/public/index.php/admin/article/drop.html?article_id=42+and" target="_blank" rel="noopener">http://test.com//dsmall506/public/index.php/admin/article/drop.html?article_id=42+and</a> updatexml(1,concat(0x7e,user()),1))<br><img src="/2020/06/29/Dsmall-Code-Audit/wps34.jpg" alt> </p>
<h2 id="SQL注入漏洞二"><a href="#SQL注入漏洞二" class="headerlink" title="SQL注入漏洞二"></a>SQL注入漏洞二</h2><p>利用条件：后台管理员权限</p>
<p>公共模块 Goodsclasstag.php delGoodsclasstagByIds 函数存在SQL注入漏洞。</p>
<p>application\common\model\Goodsclasstag.php</p>
<p><img src="/2020/06/29/Dsmall-Code-Audit/wps35.jpg" alt> </p>
<p>在Admin 控制器tag方法中对delGoodsclasstagByIds函数进行了调用，参数使用thinkphp封装函数input获取，类型是一个数组</p>
<p>aplication\admin\controller\Goodsclass.php</p>
<p>public function tag() </p>
<p><img src="/2020/06/29/Dsmall-Code-Audit/wps36.jpg" alt><br>Poc:<br><a href="http://test.com/dsmall506/public/index.php?s=admin/goodsclass/tag" target="_blank" rel="noopener">http://test.com/dsmall506/public/index.php?s=admin/goodsclass/tag</a><br>Data:<br>tag_id[0]= 1 and updatexml(1,user(),1)&amp;submit_type=del<br><img src="/2020/06/29/Dsmall-Code-Audit/wps37.jpg" alt><br><img src="/2020/06/29/Dsmall-Code-Audit/wps38.jpg" alt> </p>
<h2 id="SQL注入漏洞三"><a href="#SQL注入漏洞三" class="headerlink" title="SQL注入漏洞三"></a>SQL注入漏洞三</h2><p>利用条件：无<br>Home模块shopnearby控制器get_Own_Store_List方法存在SQL注入漏洞。<br>变量 $lat和$lng使用input 函数来获取，其实就是  $_GET或$_POST的值，这个函数是thinkphp封装的获取请求值函数。获取之后直接拼接传入where(),where()函数是thinkphp封装的函数，官方推荐使用 where(array[])来对用户数据进行处理比较安全，如果直接作为字符串参数传入该函数，那么对参数就需要用户自己进行过滤或转移处理，否则直接带入数据库进行查询，这是thinkphp官方文档的开发说明，而这里并没有按照官方文档说明来做，也没有进行转移或过滤，故造成SQL注入。</p>
<p>application\home\controller\Shopnearby.php<br><img src="/2020/06/29/Dsmall-Code-Audit/wps39.jpg" alt> </p>
<p>Poc:<br><a href="http://test.com/dsmall506/public/index.php/home/Shopnearby/get_Own_Store_List?latitude=updatexml(1,concat(0x7e,user()),1)&amp;longitude=1" target="_blank" rel="noopener">http://test.com/dsmall506/public/index.php/home/Shopnearby/get_Own_Store_List?latitude=updatexml(1,concat(0x7e,user()),1)&amp;longitude=1</a><br><img src="/2020/06/29/Dsmall-Code-Audit/wps40.jpg" alt> </p>
<h1 id="0x05-结语"><a href="#0x05-结语" class="headerlink" title="0x05 结语"></a>0x05 结语</h1><p>​        自从 2018 BlackHat Sam Thomas分享了利用phar文件触发反序列化研究之后，大大扩展了反序列化漏洞的攻击面，在审计cms的时候除了关注unserialize作为source之外，也应该重点关注这些能够利用phar文件反序列利用的函数，而对于php反序列化漏洞挖掘和利用（包括fuzz sink function 和pop chain find）期待下篇文章吧。</p>
<p><img src="/2020/06/29/Dsmall-Code-Audit/image-20200420135915050.png" alt></p>
</div><div class="tags"><a href="/tags/PHP/"><i class="fa fa-tag"></i>PHP</a><a href="/tags/%E5%8E%9F%E5%88%9B%E6%BC%8F%E6%B4%9E/"><i class="fa fa-tag"></i>原创漏洞</a><a href="/tags/CMS/"><i class="fa fa-tag"></i>CMS</a></div><div class="post-nav"><a class="pre" href="/2020/07/13/MysqlLogMonitor/">【工具开源】MysqlSql语句监控工具——MysqlLogMonitor</a><a class="next" href="/2020/06/24/Waf-Bypass-Sql/">WAF绕过奇技淫巧之SQL注入</a></div></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CTF/">CTF</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/WEB%E5%AE%89%E5%85%A8/">WEB安全</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/">二进制安全</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">代码审计</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/">信息收集</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%85%B6%E4%BB%96/">其他</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/">内网渗透</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AE%89%E5%85%A8%E5%B7%A5%E5%85%B7/">安全工具</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%A4%BE%E4%BC%9A%E5%B7%A5%E7%A8%8B%E5%AD%A6/">社会工程学</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%A7%BB%E5%8A%A8%E5%AE%89%E5%85%A8/">移动安全</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/%E5%86%B0%E8%9D%8E/" style="font-size: 15px;">冰蝎</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/%E7%99%BB%E9%99%86%E5%87%AD%E8%AF%81/" style="font-size: 15px;">登陆凭证</a> <a href="/tags/PHP/" style="font-size: 15px;">PHP</a> <a href="/tags/%E5%8E%9F%E5%88%9B%E6%BC%8F%E6%B4%9E/" style="font-size: 15px;">原创漏洞</a> <a href="/tags/CMS/" style="font-size: 15px;">CMS</a> <a href="/tags/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/" style="font-size: 15px;">内网穿透</a> <a href="/tags/JAVA/" style="font-size: 15px;">JAVA</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/PWN/" style="font-size: 15px;">PWN</a> <a href="/tags/WAF%E7%BB%95%E8%BF%87/" style="font-size: 15px;">WAF绕过</a> <a href="/tags/%E6%B5%8B%E8%AF%95%E6%8C%87%E5%8D%97/" style="font-size: 15px;">测试指南</a> <a href="/tags/Window/" style="font-size: 15px;">Window</a> <a href="/tags/%E6%9D%80%E6%AF%92%E8%BD%AF%E4%BB%B6/" style="font-size: 15px;">杀毒软件</a> <a href="/tags/Cknife/" style="font-size: 15px;">Cknife</a> <a href="/tags/%E5%AE%A1%E8%AE%A1%E5%B7%A5%E5%85%B7/" style="font-size: 15px;">审计工具</a> <a href="/tags/%E6%81%B6%E6%84%8F%E7%A8%8B%E5%BA%8F/" style="font-size: 15px;">恶意程序</a> <a href="/tags/Github/" style="font-size: 15px;">Github</a> <a href="/tags/IOS/" style="font-size: 15px;">IOS</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/08/24/Behinder3-Jsp/">冰蝎3.0-分析系列3-jsp-beta4,5</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/08/20/Behinder3-0-Beta3-PHP/">冰蝎3.0-分析系列 1-beta3-php</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/08/20/Behinder3-0-Beta2-PHP/">冰蝎3.0-分析系列 1-beta2-php</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/14/Wechat-Program/">微信小程序和公众号渗透测试指南</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/13/MysqlLogMonitor/">【工具开源】MysqlSql语句监控工具——MysqlLogMonitor</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/06/29/Dsmall-Code-Audit/">DSMall的那些洞，你能发现吗？</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/06/24/Waf-Bypass-Sql/">WAF绕过奇技淫巧之SQL注入</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/06/17/Collect-login-credentials/">linux后渗透之收集登录凭证</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/06/17/Intranet-penetration/">内网渗透之内网穿透</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/27/Subrion-Cms-Code-Audit/">Subrion CMS 代码审计</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.zerokeeper.com/" title="小李飞刀" target="_blank">小李飞刀</a><ul></ul><a href="http://cybersec.blog.51cto.com" title="网络空间安全的道与术" target="_blank">网络空间安全的道与术</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">MS509 Team.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>